CREATE TABLE rooms (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    host_id BIGINT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    code VARCHAR(255) NOT NULL
);

CREATE TABLE teams (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    room_id BIGINT NOT NULL REFERENCES rooms(id)
);

CREATE TABLE players (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    room_id BIGINT NOT NULL REFERENCES rooms(id),
    team_id BIGINT NULL REFERENCES teams(id),
    username VARCHAR(255) NOT NULL
);

ALTER TABLE rooms ADD CONSTRAINT host_id FOREIGN KEY (host_id) REFERENCES players(id);

CREATE TABLE games (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    room_id BIGINT NOT NULL REFERENCES rooms(id),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    ended_at TIMESTAMP WITH TIME ZONE NULL
);

CREATE TABLE rounds (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    game_id BIGINT NOT NULL REFERENCES games(id),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    ended_at TIMESTAMP WITH TIME ZONE NULL
);

CREATE TABLE questions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    type VARCHAR(255) NOT NULL,
    question TEXT NOT NULL,
    media_url TEXT NULL,
    options TEXT[] NOT NULL,
    correct_answers TEXT[] NOT NULL
);

CREATE TABLE round_questions (
    round_id BIGINT NOT NULL REFERENCES rounds(id),
    question_id BIGINT NOT NULL REFERENCES questions(id),
    PRIMARY KEY (round_id, question_id)
);

CREATE TABLE answers (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    round_id BIGINT NOT NULL REFERENCES rounds(id),
    question_id BIGINT NOT NULL REFERENCES questions(id),
    player_id BIGINT NOT NULL REFERENCES players(id),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    answer TEXT NOT NULL
);
